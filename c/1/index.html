<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>弹出层</title>
    <link rel="stylesheet" type="text/css" href="../../css/bootstrap.min.css" media="all"/>
    <link rel="stylesheet" type="text/css" href="../../css/bootstrap-theme.min.css" media="all"/>
    <link rel="stylesheet" type="text/css" href="../../css/reset.css" media="all"/>
    <style type="text/css">
        .col-sm-10 button{width:43%;margin:0 10px 10px;}
        .none{display:none;}
        .ui-dialog{position:fixed;text-align:center;width:500px;min-height:150px;z-index:13;background-color:#fafafc;border-radius:5px;}
        .ui-dialog-mask{position:fixed;top:0;width:100%;height:100%;left:0;z-index:1;background:rgba(0, 0, 0, 0.6);}
        .ui-dialog-title h1{font-size:17px;font-weight:400;margin:0;display:block;height:50px;line-height:50px;}
        .ui-dialog-main{line-height:1.2;padding:5px 20px;text-align:left;color:#999;}
        .ui-dialog-footer{position:relative;height:40px;line-height:40px;border-top:1px solid #e1e1e1;display:-webkit-box;display:-webkit-flex;display:flex;}
        .ui-dialog-footer a{position:relative;display:block;-webkit-box-flex:1;-webkit-flex:1;flex:1;color:#3CC51F;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);}
        .ui-dialog-footer a:first-child:after{display:none;}
        .ui-dialog-footer a:active{background-color:#EEEEEE;}
        .ui-dialog-footer a:after{content:" ";position:absolute;left:0;top:0;width:1px;height:100%;border-left:1px solid #D5D5D6;color:#D5D5D6;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:scaleX(0.5);transform:scaleX(0.5);}
        a.ui-default{color:#353535;}
    </style>
</head>
<body>
<div class="demo1">
    <form class="form-horizontal user-input" id="form" role="form">        
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <button id="btn1" type="button" class="btn btn-primary">正常弹出</button>
                <button id="btn2" type="button" class="btn btn-primary">弹出并能拖动</button>
            </div>
        </div>
    </form>
</div>
<div id="div" style="width:200px;height:200px;background:#f1f1f1;"></div>
<button id="btn">test</button>
<div style="height:1000px;"></div>
<script>
    (function(){
        var wrap = function(html, data){
            return html.replace(/{{(\w+)}}/g, function(item, a){
                return data[a];
            });
        }
        function Dialog(){
            var args = arguments[0];
            for(var i in args){
                this[i] = args[i];
            }
            this.init();
        }
        Dialog.prototype = {
            init : function(){
                this.render();
                this.bind();
            },
            setPos : function(){
                var el = this.dialog,
                    w  = el.offsetWidth,
                    h  = el.offsetHeight;
                el.style.top  = (hogo.viewSize.height - h) / 2 + 'px';
                el.style.left = (hogo.viewSize.width - w) / 2 + 'px';
            },
            render : function(){
                if(!document.getElementById(this.id)){
                    var div = document.createElement('div');
                    div.className = 'ui-dialog-outer none';
                    div.innerHTML = wrap(this.tpl, this.data);
                    document.body.appendChild(div);
                }
                this.dialog = document.getElementById(this.id);
                this.box = this.dialog.parentNode;
                this.show();
                this.setPos();
            },
            bind : function(){
                Drag(this.dialog.children[0]);
            },
            show : function(){
                this.box.style.display = 'block';
            },
            hide : function(){
                
            },
            close : function(){
                
            },
            delay : function(){
                
            },
            lock : function(){
                
            },
            unLock : function(){
                
            }
        }
        function Drag(handler){
            var startX  = 0,
                startY  = 0,
                lastX   = 0,
                lastY   = 0,
                box     = handler.parentNode,
                width   = hogo.viewSize.width,
                height  = hogo.viewSize.height,
                drag    = {
                    down: function(e){
                        e                    = hogo.getEvent(e);
                        startX               = e.clientX - box.offsetLeft;
                        startY               = e.clientY - box.offsetTop;
                        this.setCapture && this.setCapture(); // IE 下防止拖动过快丢失对象
                        hogo.addEvent(document, 'mousemove', drag.move);
                        hogo.addEvent(document, 'mouseup', drag.up);
                        return false; // 防止在 chrome 下滚屏，并丢失 cursor:move 样式
                    },
                    move: function(e){
                        e                  = hogo.getEvent(e);
                        lastX              = e.clientX - startX;
                        lastY              = e.clientY - startY;
                        lastX              = Math.max(0, Math.min(width - box.offsetWidth, lastX));
                        lastY              = Math.max(0, Math.min(height - box.offsetHeight, lastY));
                        box.style.top  = lastY + 'px';
                        box.style.left = lastX + 'px';
                        hogo.stopPropagation(e);
                        window.getSelection ? window.getSelection().removeAllRanges() : document.selection.empty(); // 取消选择文本
                    },
                    up: function(){
                        hogo.removeEvent(document, 'mousemove', drag.move);
                        hogo.removeEvent(document, 'mouseup', drag.up);
                        handler.releaseCapture && handler.releaseCapture(); // 防止拖动过快丢失对象
                    }
                };
            hogo.addEvent(handler, 'mousedown', drag.down);
        }
        var hogo = {
            css : function (obj, attr){
                if(obj.currentStyle){
                    return obj.currentStyle[attr];
                } else {
                    return getComputedStyle(obj, false)[attr];
                }
            },
            pos : function(obj, attr){
                if(obj){
                    return obj.getBoundingClientRect()[attr];    
                } else {
                    alert('对象不存在！');
                }
            },
            viewSize: function(){
                var de = document.documentElement;
                return {
                    'width': (window.innerWidth || (de && de.clientWidth) || doc.body.clientWidth),
                    'height': (window.innerHeight || (de && de.clientHeight) || doc.body.clientHeight)
                };
            }(),
            addEvent: function(ele, type, handler){
                if(ele.addEventListener){
                    ele.addEventListener(type, handler, false);
                } else if(ele.attachEvent){
                    ele.attachEvent('on' + type, handler);
                }
            },
            removeEvent: function(ele, type, handler){
                if(ele.removeEventListener){
                    ele.removeEventListener(type, handler, false);
                } else if(ele.detachEvent){
                    ele.detachEvent('on' + type, handler);
                }
            },
            stopPropagation: function(event) {
                if (event.stopPropagation) {
                    event.stopPropagation();
                } else {
                    event.cancelBubble = false;
                }
            },
            // 格式化事件
            getEvent: function(event) {
                return event || window.event;
            }
        }
        var btn1 = document.getElementById('btn1');
        var defaults = {
            id : 'dialog',
            tpl : 
                '<div id="dialog" class="ui-dialog">' + 
                    '<div class="ui-dialog-title">' + 
                        '<h1>{{title}}</h1>' + 
                        '<a href="" class="ui-dialog-close"></a>' + 
                    '</div>' + 
                    '<div class="ui-dialog-main">{{content}}</div>' + 
                    '<div class="ui-dialog-footer">' +
                        '<a href="javascript:;" class="ui-default">取消</a>' +
                        '<a href="javascript:;" class="ui-primary">确定</a>' +
                    '</div>' + 
                '</div>' + 
                '<div id="mask" class="ui-dialog-mask"></div>',
            data : {
                title : '弹出层',
                content : '<p>自定义弹窗内容，居左对齐显示，告知需要确认的信息等</p><p>自定义弹窗内容，居左对齐显示，告知需要确认的信息等</p>'
            }
        }
        btn1.onclick = function(){
            var d = new Dialog(defaults);
            // d.show();
        }
    }());
</script>
</body>
</html>